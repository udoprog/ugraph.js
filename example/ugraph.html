<!doctype html>
<html ng-app="ugraph-example" ng-controller="UgraphExampleCtrl as c">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Ugraph - Example Application">

  <title>Ugraph Test</title>

  <script src="../bower_components/d3/d3.js"  type="text/javascript"></script>
  <script src="../bower_components/angular/angular.js"  type="text/javascript"></script>
  <script src="../ugraph.js"  type="text/javascript"></script>
  <script type="text/javascript">
(function() {
  var m = angular.module('ugraph-example', ['ugraph']);

  m.controller('UgraphExampleCtrl', function($scope){
    var sources = [];
    var data = [];

    for (var i = 0; i < 10; i++) {
      sources.push(generate());
      data.push([]);
    }

    $scope.sources = sources;
    $scope.data = data;
    $scope.options = {
      stacked: true,
      highlight: true
    };

    $scope.xval = null;

    $scope.setxval = function(xval) {
      $scope.xval = xval;
    };

    $scope.sethighlight = function(hl) {
      $scope.s1h = hl;
    };
  });

  function generate() {
    var d = [];
    var count = 40;

    for (var i = 0; i < count; i++) {
      var s = {data: []};

      var start = 0 + Math.floor(Math.random() * 20);
      var end = 40 + Math.floor(Math.random() * 20);

      var min = i * 50;

      for (var j = start; j < end; j++) {
        s.data.push([j * 500, Math.floor(min + (Math.random() * 50))]);
      }

      d.push(s);
    }

    return d;
  }
})();
  </script>
</head>
<body>
  <div>
    <label>
      <span>Stacked:</span>
      <input type="checkbox" ng-model="options.stacked" />
    </label>

    <label>
      <span>Highlight:</span>
      <input type="checkbox" ng-model="options.highlight" />
    </label>
  </div>

  <div>highlight: {{xval}}</div>

  <div class="row" ng-repeat="source in sources">
    <canvas
       ugraph="source"
       ugraph-stacked="options.stacked"
       ugraph-highlight="options.highlight"
       ugraph-xval="xval"
       ugraph-hover-highlighted="setxval($highlight.x); data[$index] = $highlight.data;"
       style="width: 100%; height: 300px; background-color: white;" height="400" width="800"></canvas>

    <div ng-show="data[$index].length" style="position: absolute; top: 0; color: red; background-color: white; border: 1px solid black; padding: 5px;">
      <div ng-if="options.stacked" ng-repeat="s in data[$index] track by $index">{{s.stackValue + s.value}} ({{s.value}})</div>
      <div ng-if="!options.stacked" ng-repeat="s in data[$index] track by $index">{{s.value}}</div>
    </div>
  </div>
</body>
</html>
